<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Real-Time Financial Market Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #fff;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .status.connected {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
        }
        
        .status.disconnected {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
        }
        
        .market-data {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .price {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .change.positive {
            color: #2ecc71;
        }
        
        .change.negative {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Intelligent Real-Time Financial Market Analyzer</h1>
            <p>AI-Powered Market Analytics with Predictive Signals</p>
        </div>
        
        <div class="dashboard">
            <!-- Market Data Card -->
            <div class="card">
                <h3>ðŸ“ˆ Real-Time Market Data</h3>
                <div class="input-group">
                    <label for="symbol">Symbol:</label>
                    <input type="text" id="symbol" placeholder="e.g., AAPL, BTC-USD" value="AAPL">
                </div>
                <button class="btn" onclick="fetchMarketData()">Get Market Data</button>
                <button class="btn" onclick="connectWebSocket()" style="margin-left: 10px;">Live Stream</button>
                <div id="ws-status" class="status disconnected">WebSocket: Disconnected</div>
                <div id="market-results" class="results"></div>
            </div>
            
            <!-- Prediction Card -->
            <div class="card">
                <h3>ðŸ”® AI Price Prediction</h3>
                <div class="input-group">
                    <label for="pred-symbol">Symbol:</label>
                    <input type="text" id="pred-symbol" placeholder="e.g., AAPL" value="AAPL">
                </div>
                <div class="input-group">
                    <label for="timeframe">Timeframe:</label>
                    <input type="text" id="timeframe" placeholder="e.g., 1h, 1d" value="1h">
                </div>
                <button class="btn" onclick="getPrediction()">Get Prediction</button>
                <div id="prediction-results" class="results"></div>
            </div>
            
            <!-- Sentiment Analysis Card -->
            <div class="card">
                <h3>ðŸ’­ Sentiment Analysis</h3>
                <div class="input-group">
                    <label for="text-input">Text to Analyze:</label>
                    <textarea id="text-input" rows="3" placeholder="Enter news text or market commentary...">Apple stock is showing strong momentum with great quarterly results!</textarea>
                </div>
                <button class="btn" onclick="analyzeSentiment()">Analyze Sentiment</button>
                <div id="sentiment-results" class="results"></div>
            </div>
            
            <!-- Market Signals Card -->
            <div class="card">
                <h3>âš¡ Market Signals</h3>
                <div class="input-group">
                    <label for="signal-symbol">Symbol:</label>
                    <input type="text" id="signal-symbol" placeholder="e.g., AAPL" value="AAPL">
                </div>
                <button class="btn" onclick="getSignals()">Get Signals</button>
                <button class="btn" onclick="connectSignalWebSocket()" style="margin-left: 10px;">Live Signals</button>
                <div id="signal-results" class="results"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let marketWs = null;
        let signalWs = null;

        // Fetch market data
        async function fetchMarketData() {
            const symbol = document.getElementById('symbol').value;
            const resultsDiv = document.getElementById('market-results');
            
            try {
                resultsDiv.innerHTML = '<p>Loading...</p>';
                const response = await fetch(`${API_BASE}/market-data/${symbol}`);
                const data = await response.json();
                
                if (data.length > 0) {
                    resultsDiv.innerHTML = data.slice(0, 5).map(point => `
                        <div class="market-data">
                            <span>${new Date(point.timestamp).toLocaleTimeString()}</span>
                            <span class="price">$${point.price.toFixed(2)}</span>
                            <span>Vol: ${point.volume ? point.volume.toLocaleString() : 'N/A'}</span>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML = '<p>No data available</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        // Get price prediction
        async function getPrediction() {
            const symbol = document.getElementById('pred-symbol').value;
            const timeframe = document.getElementById('timeframe').value;
            const resultsDiv = document.getElementById('prediction-results');
            
            try {
                resultsDiv.innerHTML = '<p>Analyzing...</p>';
                const response = await fetch(`${API_BASE}/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbol, timeframe })
                });
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <div style="text-align: center;">
                        <h4>Prediction for ${data.symbol}</h4>
                        <div class="price">$${data.prediction.toFixed(2)}</div>
                        <p>Confidence: ${(data.confidence * 100).toFixed(1)}%</p>
                        <small>Generated: ${new Date(data.timestamp).toLocaleString()}</small>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        // Analyze sentiment
        async function analyzeSentiment() {
            const text = document.getElementById('text-input').value;
            const resultsDiv = document.getElementById('sentiment-results');
            
            try {
                resultsDiv.innerHTML = '<p>Analyzing sentiment...</p>';
                const response = await fetch(`${API_BASE}/sentiment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const data = await response.json();
                
                const sentimentColor = data.sentiment === 'positive' ? '#2ecc71' : 
                                     data.sentiment === 'negative' ? '#e74c3c' : '#f39c12';
                
                resultsDiv.innerHTML = `
                    <div style="text-align: center;">
                        <h4 style="color: ${sentimentColor};">${data.sentiment.toUpperCase()}</h4>
                        <p>Confidence: ${(data.confidence * 100).toFixed(1)}%</p>
                        <div style="margin-top: 10px;">
                            ${Object.entries(data.scores).map(([key, value]) => 
                                `<div>${key}: ${(value * 100).toFixed(1)}%</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        // Get market signals
        async function getSignals() {
            const symbol = document.getElementById('signal-symbol').value;
            const resultsDiv = document.getElementById('signal-results');
            
            try {
                resultsDiv.innerHTML = '<p>Generating signals...</p>';
                const response = await fetch(`${API_BASE}/signals/${symbol}`);
                const data = await response.json();
                
                if (data.length > 0) {
                    const signal = data[0];
                    const signalColor = signal.signal_type === 'buy' ? '#2ecc71' : 
                                       signal.signal_type === 'sell' ? '#e74c3c' : '#f39c12';
                    
                    resultsDiv.innerHTML = `
                        <div style="text-align: center;">
                            <h4 style="color: ${signalColor};">${signal.signal_type.toUpperCase()}</h4>
                            <p>Strength: ${(signal.strength * 100).toFixed(1)}%</p>
                            <div style="margin-top: 10px; font-size: 0.9em;">
                                <div>RSI: ${signal.indicators.rsi?.toFixed(2) || 'N/A'}</div>
                                <div>Current: $${signal.indicators.current_price?.toFixed(2) || 'N/A'}</div>
                                <div>Predicted: $${signal.indicators.predicted_price?.toFixed(2) || 'N/A'}</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = '<p>No signals available</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        // WebSocket for real-time market data
        function connectWebSocket() {
            const symbol = document.getElementById('symbol').value;
            const statusDiv = document.getElementById('ws-status');
            const resultsDiv = document.getElementById('market-results');
            
            if (marketWs) {
                marketWs.close();
            }
            
            marketWs = new WebSocket(`ws://localhost:8000/api/v1/ws/market-data`);
            
            marketWs.onopen = function() {
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'WebSocket: Connected';
                marketWs.send(symbol);
            };
            
            marketWs.onmessage = function(event) {
                const message = JSON.parse(event.data);
                if (message.type === 'market_data') {
                    const point = message.data;
                    resultsDiv.innerHTML = `
                        <div class="market-data">
                            <span>LIVE</span>
                            <span class="price">$${point.price.toFixed(2)}</span>
                            <span>${new Date(point.timestamp).toLocaleTimeString()}</span>
                        </div>
                    ` + resultsDiv.innerHTML;
                }
            };
            
            marketWs.onclose = function() {
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'WebSocket: Disconnected';
            };
        }

        // WebSocket for real-time signals
        function connectSignalWebSocket() {
            const resultsDiv = document.getElementById('signal-results');
            
            if (signalWs) {
                signalWs.close();
            }
            
            signalWs = new WebSocket(`ws://localhost:8000/api/v1/ws/signals`);
            
            signalWs.onopen = function() {
                resultsDiv.innerHTML = '<p>Connected to live signals...</p>';
            };
            
            signalWs.onmessage = function(event) {
                const message = JSON.parse(event.data);
                if (message.type === 'market_signal') {
                    const signal = message.data;
                    const signalColor = signal.signal_type === 'buy' ? '#2ecc71' : 
                                       signal.signal_type === 'sell' ? '#e74c3c' : '#f39c12';
                    
                    resultsDiv.innerHTML = `
                        <div style="border-left: 4px solid ${signalColor}; padding-left: 10px; margin-bottom: 10px;">
                            <strong>${signal.symbol}: ${signal.signal_type.toUpperCase()}</strong>
                            <div>Strength: ${(signal.strength * 100).toFixed(1)}%</div>
                            <small>${new Date(signal.timestamp).toLocaleTimeString()}</small>
                        </div>
                    ` + resultsDiv.innerHTML;
                }
            };
        }

        // Health check on page load
        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                console.log('API Health:', data);
            } catch (error) {
                console.error('API not available:', error);
            }
        }

        // Initialize
        checkHealth();
    </script>
</body>
</html>
